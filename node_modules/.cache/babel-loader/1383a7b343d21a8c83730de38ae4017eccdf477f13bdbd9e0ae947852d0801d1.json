{"ast":null,"code":"import { ethers } from \"ethers\";\nimport { CONTRACT_ADDRESSES, TOKEN_ABI } from \"../../src/constants/abis\"; // ‚úÖ Fixed import structure\n\n// ‚úÖ Ensure the correct provider is always used\nconst provider = window.ethereum ? new ethers.providers.Web3Provider(window.ethereum) : new ethers.providers.JsonRpcProvider(\"http://127.0.0.1:8545\"); // ‚úÖ Fallback to localhost\n\n/** Function to get ERC-20 Approvals */\nexport async function getERC20Approvals(tokenContracts, ownerAddress, passedProvider = provider) {\n  let approvals = [];\n\n  // ‚úÖ List of spender addresses to check\n  const spenderAddresses = [CONTRACT_ADDRESSES.TK1,\n  // ‚úÖ Token contract itself\n  \"0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266\" // ‚úÖ Test wallet\n  ];\n  try {\n    // ‚úÖ Validate the owner address\n    if (!ethers.utils.isAddress(ownerAddress)) {\n      throw new Error(`Invalid owner address: ${ownerAddress}`);\n    }\n    const owner = ethers.utils.getAddress(ownerAddress);\n    console.log(\"üîç Debug: Token Contracts Input:\", tokenContracts);\n    for (let tokenAddress of tokenContracts) {\n      if (!ethers.utils.isAddress(tokenAddress)) {\n        console.error(`‚ùå Invalid token address: ${tokenAddress}`);\n        continue;\n      }\n\n      // ‚úÖ Create contract instance with the correct provider\n      const contract = new ethers.Contract(tokenAddress, TOKEN_ABI, passedProvider);\n      for (let spender of spenderAddresses) {\n        console.log(`üõ†Ô∏è Checking allowance for spender: ${spender}`);\n        try {\n          const allowance = await contract.allowance(owner, spender);\n          if (allowance.gt(0)) {\n            approvals.push({\n              contract: tokenAddress,\n              type: \"ERC-20\",\n              spender: spender,\n              amount: allowance.toString()\n            });\n          }\n        } catch (error) {\n          console.error(`‚ùå Error fetching allowance for spender: ${spender} on token: ${tokenAddress}`, error);\n        }\n      }\n    }\n  } catch (error) {\n    console.error(\"‚ùå Error in getERC20Approvals function:\", error);\n  }\n  return approvals;\n}","map":{"version":3,"names":["ethers","CONTRACT_ADDRESSES","TOKEN_ABI","provider","window","ethereum","providers","Web3Provider","JsonRpcProvider","getERC20Approvals","tokenContracts","ownerAddress","passedProvider","approvals","spenderAddresses","TK1","utils","isAddress","Error","owner","getAddress","console","log","tokenAddress","error","contract","Contract","spender","allowance","gt","push","type","amount","toString"],"sources":["/Users/markemery/mini.revoke/src/utils/erc20Approvals.js"],"sourcesContent":["import { ethers } from \"ethers\";\nimport { CONTRACT_ADDRESSES, TOKEN_ABI } from \"../../src/constants/abis\"; // ‚úÖ Fixed import structure\n\n// ‚úÖ Ensure the correct provider is always used\nconst provider = window.ethereum\n    ? new ethers.providers.Web3Provider(window.ethereum)\n    : new ethers.providers.JsonRpcProvider(\"http://127.0.0.1:8545\"); // ‚úÖ Fallback to localhost\n\n/** Function to get ERC-20 Approvals */\nexport async function getERC20Approvals(tokenContracts, ownerAddress, passedProvider = provider) {\n    let approvals = [];\n\n    // ‚úÖ List of spender addresses to check\n    const spenderAddresses = [\n        CONTRACT_ADDRESSES.TK1, // ‚úÖ Token contract itself\n        \"0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266\" // ‚úÖ Test wallet\n    ];\n\n    try {\n        // ‚úÖ Validate the owner address\n        if (!ethers.utils.isAddress(ownerAddress)) {\n            throw new Error(`Invalid owner address: ${ownerAddress}`);\n        }\n        const owner = ethers.utils.getAddress(ownerAddress);\n\n        console.log(\"üîç Debug: Token Contracts Input:\", tokenContracts);\n\n        for (let tokenAddress of tokenContracts) {\n            if (!ethers.utils.isAddress(tokenAddress)) {\n                console.error(`‚ùå Invalid token address: ${tokenAddress}`);\n                continue;\n            }\n\n            // ‚úÖ Create contract instance with the correct provider\n            const contract = new ethers.Contract(tokenAddress, TOKEN_ABI, passedProvider);\n\n            for (let spender of spenderAddresses) {\n                console.log(`üõ†Ô∏è Checking allowance for spender: ${spender}`);\n                try {\n                    const allowance = await contract.allowance(owner, spender);\n                    if (allowance.gt(0)) {\n                        approvals.push({\n                            contract: tokenAddress,\n                            type: \"ERC-20\",\n                            spender: spender,\n                            amount: allowance.toString(),\n                        });\n                    }\n                } catch (error) {\n                    console.error(`‚ùå Error fetching allowance for spender: ${spender} on token: ${tokenAddress}`, error);\n                }\n            }\n        }\n    } catch (error) {\n        console.error(\"‚ùå Error in getERC20Approvals function:\", error);\n    }\n\n    return approvals;\n}\n"],"mappings":"AAAA,SAASA,MAAM,QAAQ,QAAQ;AAC/B,SAASC,kBAAkB,EAAEC,SAAS,QAAQ,0BAA0B,CAAC,CAAC;;AAE1E;AACA,MAAMC,QAAQ,GAAGC,MAAM,CAACC,QAAQ,GAC1B,IAAIL,MAAM,CAACM,SAAS,CAACC,YAAY,CAACH,MAAM,CAACC,QAAQ,CAAC,GAClD,IAAIL,MAAM,CAACM,SAAS,CAACE,eAAe,CAAC,uBAAuB,CAAC,CAAC,CAAC;;AAErE;AACA,OAAO,eAAeC,iBAAiBA,CAACC,cAAc,EAAEC,YAAY,EAAEC,cAAc,GAAGT,QAAQ,EAAE;EAC7F,IAAIU,SAAS,GAAG,EAAE;;EAElB;EACA,MAAMC,gBAAgB,GAAG,CACrBb,kBAAkB,CAACc,GAAG;EAAE;EACxB,4CAA4C,CAAC;EAAA,CAChD;EAED,IAAI;IACA;IACA,IAAI,CAACf,MAAM,CAACgB,KAAK,CAACC,SAAS,CAACN,YAAY,CAAC,EAAE;MACvC,MAAM,IAAIO,KAAK,CAAC,0BAA0BP,YAAY,EAAE,CAAC;IAC7D;IACA,MAAMQ,KAAK,GAAGnB,MAAM,CAACgB,KAAK,CAACI,UAAU,CAACT,YAAY,CAAC;IAEnDU,OAAO,CAACC,GAAG,CAAC,kCAAkC,EAAEZ,cAAc,CAAC;IAE/D,KAAK,IAAIa,YAAY,IAAIb,cAAc,EAAE;MACrC,IAAI,CAACV,MAAM,CAACgB,KAAK,CAACC,SAAS,CAACM,YAAY,CAAC,EAAE;QACvCF,OAAO,CAACG,KAAK,CAAC,4BAA4BD,YAAY,EAAE,CAAC;QACzD;MACJ;;MAEA;MACA,MAAME,QAAQ,GAAG,IAAIzB,MAAM,CAAC0B,QAAQ,CAACH,YAAY,EAAErB,SAAS,EAAEU,cAAc,CAAC;MAE7E,KAAK,IAAIe,OAAO,IAAIb,gBAAgB,EAAE;QAClCO,OAAO,CAACC,GAAG,CAAC,uCAAuCK,OAAO,EAAE,CAAC;QAC7D,IAAI;UACA,MAAMC,SAAS,GAAG,MAAMH,QAAQ,CAACG,SAAS,CAACT,KAAK,EAAEQ,OAAO,CAAC;UAC1D,IAAIC,SAAS,CAACC,EAAE,CAAC,CAAC,CAAC,EAAE;YACjBhB,SAAS,CAACiB,IAAI,CAAC;cACXL,QAAQ,EAAEF,YAAY;cACtBQ,IAAI,EAAE,QAAQ;cACdJ,OAAO,EAAEA,OAAO;cAChBK,MAAM,EAAEJ,SAAS,CAACK,QAAQ,CAAC;YAC/B,CAAC,CAAC;UACN;QACJ,CAAC,CAAC,OAAOT,KAAK,EAAE;UACZH,OAAO,CAACG,KAAK,CAAC,2CAA2CG,OAAO,cAAcJ,YAAY,EAAE,EAAEC,KAAK,CAAC;QACxG;MACJ;IACJ;EACJ,CAAC,CAAC,OAAOA,KAAK,EAAE;IACZH,OAAO,CAACG,KAAK,CAAC,wCAAwC,EAAEA,KAAK,CAAC;EAClE;EAEA,OAAOX,SAAS;AACpB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}